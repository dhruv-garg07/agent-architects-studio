{% extends "base.html" %}

{% block title %}AI Agent Marketplace - Discover and Deploy AI Agents{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="relative overflow-hidden pt-16 pb-32">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-4xl sm:text-6xl font-bold text-foreground mb-6">
                Discover the Future of
                <span class="text-primary">AI Agents</span>
            </h1>
            <p class="text-xl sm:text-2xl text-muted-foreground mb-8 max-w-3xl mx-auto">
                Explore, deploy, and monetize cutting-edge AI agents. Join the revolution in autonomous digital assistants.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="{{ url_for('explore') }}" class="btn-primary text-lg px-8 py-3 inline-flex items-center">
                    <i data-lucide="search" class="mr-2 h-5 w-5"></i>
                    Explore Agents
                </a>
                <a href="{{ url_for('creator_studio') }}" class="btn-secondary text-lg px-8 py-3 inline-flex items-center">
                    <i data-lucide="plus" class="mr-2 h-5 w-5"></i>
                    Submit Your Agent
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Blueprint Section -->
<section class="py-16 bg-muted/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">
                Our Vision & Roadmap
            </h2>
            <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
                Building the future of AI collaboration, one phase at a time
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Phase 1: Agent Registry -->
            <div class="card card-elevated p-8 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-primary rounded-full mb-6">
                    <span class="text-2xl font-bold text-primary-foreground">1</span>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-4">Agent Registry</h3>
                <p class="text-muted-foreground mb-4">
                    A platform for developers to list and showcase their already-deployed AI agents via a base URL.
                </p>
                <div class="mt-4">
                    <span class="inline-flex items-center bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">
                        <i data-lucide="check-circle" class="mr-1 h-4 w-4"></i>
                        Launched
                    </span>
                </div>
            </div>
            
            <!-- Phase 2: Memory Passport -->
            <div class="card card-elevated p-8 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-sage rounded-full mb-6">
                    <span class="text-2xl font-bold text-sage-foreground">2</span>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-4">The Memory Passport</h3>
                <p class="text-muted-foreground mb-4">
                    Our first product: allows users to share context between different consumer AIs.
                </p>
                <div class="mt-4">
                    <div class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full mb-2">
                        <span id="waitlist-count">{{ waitlist_count | default(114) }}</span>+ waitlist signups
                    </div>
                    <button onclick="openWaitlistModal()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                        Join the waitlist →
                    </button>
                </div>
            </div>
            
            <!-- Phase 3: Manhattan Project -->
            <div class="card card-elevated p-8 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-dusty-blue rounded-full mb-6">
                    <span class="text-2xl font-bold text-dusty-blue-foreground">3</span>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-4">The Manhattan Project</h3>
                <p class="text-muted-foreground">
                    Enabling true collaboration, conflict resolution, and distributed workflows for all agents.
                </p>
                <div class="mt-4">
                    <span class="inline-flex items-center bg-gray-100 text-gray-800 text-sm font-medium px-3 py-1 rounded-full">
                        <i data-lucide="clock" class="mr-1 h-4 w-4"></i>
                        Coming soon
                    </span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Waitlist Modal -->
<div id="waitlist-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-card border border-border rounded-lg p-6 m-4 max-w-md w-full card-elevated">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-foreground">Join the Waitlist</h3>
            <button onclick="closeWaitlistModal()" class="text-muted-foreground hover:text-foreground">
                <i data-lucide="x" class="h-5 w-5"></i>
            </button>
        </div>
        <p class="text-muted-foreground mb-4">
            Be the first to know when The Memory Passport launches. Enter your email below to join the waitlist.
        </p>
        <form id="waitlist-form" onsubmit="submitWaitlist(event)">
            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-foreground mb-2">Email Address</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    required 
                    class="input w-full"
                    placeholder="your.email@example.com"
                >
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeWaitlistModal()" class="btn-secondary">
                    Cancel
                </button>
                <button type="submit" class="btn-primary">
                    Join Waitlist
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Features Section -->
<section class="py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">
                Why Choose Our Platform?
            </h2>
            <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
                Experience the next generation of AI agents with our comprehensive marketplace
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Feature 1 -->
            <div class="card card-elevated p-8 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-primary rounded-full mb-6">
                    <i data-lucide="brain-circuit" class="h-8 w-8 text-primary-foreground"></i>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-4">Smart AI Agents</h3>
                <p class="text-muted-foreground">
                    Discover intelligent agents powered by the latest AI models and technologies
                </p>
            </div>
            
            <!-- Feature 2 -->
            <div class="card card-elevated p-8 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-sage rounded-full mb-6">
                    <i data-lucide="users" class="h-8 w-8 text-sage-foreground"></i>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-4">Creator Community</h3>
                <p class="text-muted-foreground">
                    Join a vibrant community of AI developers and researchers
                </p>
            </div>
            
            <!-- Feature 3 -->
            <div class="card card-elevated p-8 text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-dusty-blue rounded-full mb-6">
                    <i data-lucide="shield-check" class="h-8 w-8 text-dusty-blue-foreground"></i>
                </div>
                <h3 class="text-xl font-semibold text-foreground mb-4">Verified Quality</h3>
                <p class="text-muted-foreground">
                    All agents are reviewed and verified for quality and safety
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
<section class="py-16 bg-card">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-center">
            <div>
                <div class="text-4xl font-bold text-primary mb-2" id="agent-count">1,000+</div>
                <div class="text-muted-foreground">AI Agents</div>
            </div>
            <div>
                <div class="text-4xl font-bold text-sage mb-2">500+</div>
                <div class="text-muted-foreground">Creators</div>
            </div>
            <div>
                <div class="text-4xl font-bold text-dusty-blue mb-2">10M+</div>
                <div class="text-muted-foreground">Total Runs</div>
            </div>
            <div>
                <div class="text-4xl font-bold text-soft-ochre mb-2">4.8★</div>
                <div class="text-muted-foreground">Average Rating</div>
            </div>
        </div>
    </div>
</section>

<!-- Categories Section -->
<section class="py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h2 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">
                Popular Categories
            </h2>
            <p class="text-xl text-muted-foreground">
                Explore agents across various domains and use cases
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Category Cards -->
            {% set categories = [
                ('automation', 'Automation', 'Streamline workflows and processes'),
                ('content', 'Content Creation', 'Generate and optimize content'),
                ('analysis', 'Data Analysis', 'Extract insights from data'),
                ('customer-service', 'Customer Service', 'Enhance customer interactions'),
                ('productivity', 'Productivity', 'Boost efficiency and output'),
                ('research', 'Research', 'Accelerate research and discovery'),
                ('education', 'Education', 'Personalized learning experiences'),
                ('finance', 'Finance', 'Financial analysis and insights')
            ] %}
            
            {% for icon, name, description in categories %}
                <a href="{{ url_for('explore', category=name.lower().replace(' ', '-')) }}" 
                   class="card card-elevated p-6 hover:scale-105 transition-transform">
                    <div class="flex items-center mb-3">
                        <i data-lucide="{{ icon }}" class="h-6 w-6 text-primary mr-3"></i>
                        <h3 class="font-semibold text-foreground">{{ name }}</h3>
                    </div>
                    <p class="text-sm text-muted-foreground">{{ description }}</p>
                </a>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-16 bg-primary">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl sm:text-4xl font-bold text-primary-foreground mb-4">
            Ready to Get Started?
        </h2>
        <p class="text-xl text-primary-foreground/80 mb-8 max-w-2xl mx-auto">
            Join thousands of developers and businesses leveraging AI agents to transform their workflows
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="{{ url_for('explore') }}" 
               class="bg-primary-foreground text-primary px-8 py-3 rounded-lg font-semibold hover:bg-primary-foreground/90 transition-colors">
                Browse Agents
            </a>
            <a href="{{ url_for('creator_studio') }}" 
               class="border border-primary-foreground text-primary-foreground px-8 py-3 rounded-lg font-semibold hover:bg-primary-foreground/10 transition-colors">
                Become a Creator
            </a>
        </div>
    </div>
</section>

<script>
// Function to update agent count from Supabase
async function updateAgentCount() {
    try {
        // This would be replaced with your actual Supabase function call
        const response = await fetch('/api/agent-count');
        const data = await response.json();
        document.getElementById('agent-count').textContent = data.count.toLocaleString() + '+';
    } catch (error) {
        console.error('Error fetching agent count:', error);
        // Keep the default value if there's an error
    }
}

// Waitlist modal functions (frontend UI - remains in JS)
function openWaitlistModal() {
    document.getElementById('waitlist-modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // Prevent scrolling
}

function closeWaitlistModal() {
    document.getElementById('waitlist-modal').classList.add('hidden');
    document.body.style.overflow = ''; // Re-enable scrolling
}

// Function to handle waitlist form submission
// Function to handle waitlist form submission
async function submitWaitlist(event) {
    event.preventDefault();
    
    const form = event.target;
    const email = form.email.value;
    const submitButton = form.querySelector('button[type="submit"]');
    const originalButtonText = submitButton.textContent;
    
    if (!email || !email.includes('@')) {
        alert('Please enter a valid email address.');
        return;
    }
    
    try {
        // Show loading state
        submitButton.disabled = true;
        submitButton.textContent = 'Joining...';
        
        // Prepare data to send
        const formData = { email: email };
        
        // If you have user authentication info available in the frontend
        // you could add it here, but typically this is handled by the backend
        // using the session authentication
        
        // Call Python Flask endpoint
        const response = await fetch("{{ url_for('join_waitlist') }}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        });
        
        if (response.ok) {
            const result = await response.json();
            // Update the waitlist count
            document.getElementById('waitlist-count').textContent = result.new_count;
            
            // Show success message
            alert('Successfully joined the waitlist! Thank you for your interest.');
            
            // Close the modal
            closeWaitlistModal();
            
            // Reset form
            form.reset();
        } else {
            throw new Error('Failed to join waitlist');
        }
    } catch (error) {
        console.error('Error joining waitlist:', error);
        alert('There was an error joining the waitlist. Please try again.');
    } finally {
        // Reset button state
        submitButton.disabled = false;
        submitButton.textContent = originalButtonText;
    }
}

// Close modal when clicking outside
document.getElementById('waitlist-modal').addEventListener('click', function(event) {
    if (event.target === this) {
        closeWaitlistModal();
    }
});

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    updateAgentCount();
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeWaitlistModal();
        }
    });
});

</script>
{% endblock %}
{% extends 'base.html' %}

{% block title %}Manhattan Memory MCP – Documentation{% endblock %}

{% block content %}
<div class="mcp-wrap">

    <!-- ══════  LEFT SIDEBAR  ══════ -->
    <aside class="mcp-sidebar" id="mcp-sidebar">
        <div class="mcp-sidebar-scroll" id="sidebar-nav">
            <!-- Populated by JS -->
        </div>
    </aside>

    <!-- Mobile Overlay -->
    <div class="mcp-overlay" id="mcp-overlay"></div>

    <!-- ══════  MAIN CONTENT  ══════ -->
    <main class="mcp-main" id="mcp-main">

        <!-- Hero -->
        <div class="mcp-hero">
            <div class="mcp-hero-badge">Documentation</div>
            <h1>Manhattan Memory MCP</h1>
            <p>AI-powered persistent memory for Claude, Cursor, and other AI agents.</p>
        </div>

        <!-- Quick-Link Cards -->
        <section class="mcp-section" id="section-overview">
            <div class="mcp-grid-cards">
                <a href="#section-quick-start" class="mcp-card">
                    <div class="mcp-card-top">
                        <span class="mcp-card-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                            </svg></span>
                    </div>
                    <strong>Quick Start</strong>
                    <p>Get up and running in under 2 minutes.</p>
                </a>
                <a href="#section-features" class="mcp-card">
                    <div class="mcp-card-top">
                        <span class="mcp-card-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5z" />
                                <path d="M2 17l10 5 10-5" />
                                <path d="M2 12l10 5 10-5" />
                            </svg></span>
                    </div>
                    <strong>Features</strong>
                    <p>Persistent memory, semantic search, multi-agent.</p>
                </a>
                <a href="#section-config" class="mcp-card">
                    <div class="mcp-card-top">
                        <span class="mcp-card-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3" />
                                <path
                                    d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z" />
                            </svg></span>
                    </div>
                    <strong>Configuration</strong>
                    <p>Setup for Claude, Cursor, Copilot, Windsurf.</p>
                </a>
                <a href="#section-memory-ops" class="mcp-card">
                    <div class="mcp-card-top">
                        <span class="mcp-card-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <polyline points="10 9 9 9 8 9" />
                            </svg></span>
                    </div>
                    <strong>Tools Reference</strong>
                    <p>Memory, agent, session, and AI helper tools.</p>
                </a>
            </div>
        </section>

        <!-- ── Install ── -->
        <section class="mcp-section" id="section-install">
            <h2>Install</h2>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div>
                    <span>Terminal</span>
                    <button class="mcp-copy" data-copy>Copy</button>
                </div>
                <pre><code>pip install manhattan-mcp</code></pre>
            </div>
        </section>

        <!-- ── Quick Start ── -->
        <section class="mcp-section" id="section-quick-start">
            <h2>Quick Start</h2>

            <h3 id="h-step1">1. Get Your API Key</h3>
            <p>Sign up at <a href="https://themanhattanproject.ai">themanhattanproject.ai</a> to get your API key.</p>

            <h3 id="h-step2">2. Install the Package</h3>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div>
                    <span>Terminal</span>
                    <button class="mcp-copy" data-copy>Copy</button>
                </div>
                <pre><code>pip install manhattan-mcp</code></pre>
            </div>

            <h3 id="h-step3">3. Set Your API Key</h3>
            <p>Export as an environment variable or add to a <code>.env</code> file:</p>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div>
                    <span>bash</span>
                    <button class="mcp-copy" data-copy>Copy</button>
                </div>
                <pre><code>export MANHATTAN_API_KEY="your-api-key-here"</code></pre>
            </div>
        </section>

        <!-- ── Features ── -->
        <section class="mcp-section" id="section-features">
            <h2>Features</h2>
            <div class="mcp-feature-list">
                <div class="mcp-feat"><span class="mcp-feat-dot" style="--c:#6366f1"></span>
                    <div><strong>Persistent Memory</strong>
                        <p>Store and retrieve information across conversations and sessions.</p>
                    </div>
                </div>
                <div class="mcp-feat"><span class="mcp-feat-dot" style="--c:#06b6d4"></span>
                    <div><strong>Semantic Search</strong>
                        <p>Find relevant memories using natural language queries.</p>
                    </div>
                </div>
                <div class="mcp-feat"><span class="mcp-feat-dot" style="--c:#f59e0b"></span>
                    <div><strong>AI-Generated Answers</strong>
                        <p>Get comprehensive answers using memory context directly.</p>
                    </div>
                </div>
                <div class="mcp-feat"><span class="mcp-feat-dot" style="--c:#10b981"></span>
                    <div><strong>Multi-Agent Support</strong>
                        <p>Separate memory spaces for different use cases or projects.</p>
                    </div>
                </div>
                <div class="mcp-feat"><span class="mcp-feat-dot" style="--c:#ec4899"></span>
                    <div><strong>Analytics</strong>
                        <p>Track memory usage, queries, and performance metrics.</p>
                    </div>
                </div>
                <div class="mcp-feat"><span class="mcp-feat-dot" style="--c:#8b5cf6"></span>
                    <div><strong>Export / Import</strong>
                        <p>Export and import your memory data easily.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ── Configuration ── -->
        <section class="mcp-section" id="section-config">
            <h2>Configuration</h2>

            <h3 id="h-sse">Manhattan Remote (SSE)</h3>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div><span>json</span><button class="mcp-copy"
                        data-copy>Copy</button>
                </div>
                <pre><code>{
  "mcpServers": {
    "Manhattan_Remote": {
      "serverUrl": "https://themanhattanproject.ai/mcp/sse",
      "headers": {
        "Authorization": "Bearer YOUR_API_KEY"
      }
    }
  }
}</code></pre>
            </div>

            <h3 id="h-copilot">GitHub Copilot</h3>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div><span>json</span><button class="mcp-copy"
                        data-copy>Copy</button>
                </div>
                <pre><code>{
  "servers": {
    "manhattan_pip": {
      "command": "manhattan-mcp",
      "args": ["start"],
      "env": {
        "MANHATTAN_API_KEY": "YOUR_API_KEY",
        "MANHATTAN_API_URL": "https://www.themanhattanproject.ai"
      },
      "disabledTools": []
    }
  }
}</code></pre>
            </div>

            <h3 id="h-claude">Claude Desktop</h3>
            <p>Add to <code>claude_desktop_config.json</code>:</p>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div><span>json</span><button class="mcp-copy"
                        data-copy>Copy</button>
                </div>
                <pre><code>{
  "mcpServers": {
    "manhattan": {
      "command": "manhattan-mcp",
      "args": ["start"],
      "env": {
        "MANHATTAN_API_KEY": "your-api-key-here"
      }
    }
  }
}</code></pre>
            </div>

            <h3 id="h-cursor">Cursor IDE</h3>
            <p>Add to <code>.cursor/mcp.json</code>:</p>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div><span>json</span><button class="mcp-copy"
                        data-copy>Copy</button>
                </div>
                <pre><code>{
  "mcpServers": {
    "manhattan": {
      "command": "manhattan-mcp",
      "env": {
        "MANHATTAN_API_KEY": "your-api-key-here"
      }
    }
  }
}</code></pre>
            </div>

            <h3 id="h-windsurf">Windsurf</h3>
            <div class="mcp-code">
                <div class="mcp-code-bar">
                    <div class="mcp-code-dots"><i></i><i></i><i></i></div><span>json</span><button class="mcp-copy"
                        data-copy>Copy</button>
                </div>
                <pre><code>{
  "mcpServers": {
    "manhattan": {
      "command": "manhattan-mcp",
      "args": ["start"],
      "env": {
        "MANHATTAN_API_KEY": "your-api-key-here"
      }
    }
  }
}</code></pre>
            </div>
        </section>

        <!-- ── Tools ── -->
        <section class="mcp-section" id="section-memory-ops">
            <h2>Memory Operations</h2>
            <div class="mcp-tbl-wrap">
                <table class="mcp-tbl">
                    <thead>
                        <tr>
                            <th>Tool</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>search_memory</code></td>
                            <td>Search memories using natural language</td>
                        </tr>
                        <tr>
                            <td><code>add_memory_direct</code></td>
                            <td>Store structured memories</td>
                        </tr>
                        <tr>
                            <td><code>get_context_answer</code></td>
                            <td>Get AI answers using memory context</td>
                        </tr>
                        <tr>
                            <td><code>update_memory_entry</code></td>
                            <td>Update existing memories</td>
                        </tr>
                        <tr>
                            <td><code>delete_memory_entries</code></td>
                            <td>Delete specific memories</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="mcp-section" id="section-agent-mgmt">
            <h2>Agent Management</h2>
            <div class="mcp-tbl-wrap">
                <table class="mcp-tbl">
                    <thead>
                        <tr>
                            <th>Tool</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>create_agent</code></td>
                            <td>Create a new memory agent</td>
                        </tr>
                        <tr>
                            <td><code>list_agents</code></td>
                            <td>List all your agents</td>
                        </tr>
                        <tr>
                            <td><code>get_agent</code></td>
                            <td>Get agent details</td>
                        </tr>
                        <tr>
                            <td><code>update_agent</code></td>
                            <td>Update agent configuration</td>
                        </tr>
                        <tr>
                            <td><code>delete_agent</code></td>
                            <td>Permanently delete an agent</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="mcp-section" id="section-session-mgmt">
            <h2>Session Management</h2>
            <div class="mcp-tbl-wrap">
                <table class="mcp-tbl">
                    <thead>
                        <tr>
                            <th>Tool</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>session_start</code></td>
                            <td>Initialize a conversation</td>
                        </tr>
                        <tr>
                            <td><code>session_end</code></td>
                            <td>End session and sync memories</td>
                        </tr>
                        <tr>
                            <td><code>pull_context</code></td>
                            <td>Load relevant context</td>
                        </tr>
                        <tr>
                            <td><code>push_memories</code></td>
                            <td>Sync pending memories</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section class="mcp-section" id="section-ai-helpers">
            <h2>AI Helpers</h2>
            <div class="mcp-tbl-wrap">
                <table class="mcp-tbl">
                    <thead>
                        <tr>
                            <th>Tool</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>auto_remember</code></td>
                            <td>Automatically extract facts from messages</td>
                        </tr>
                        <tr>
                            <td><code>should_remember</code></td>
                            <td>Check if info is worth storing</td>
                        </tr>
                        <tr>
                            <td><code>what_do_i_know</code></td>
                            <td>Summary of known user info</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- ══════  RIGHT TOC  ══════ -->
    <aside class="mcp-toc" id="mcp-toc">
        <div class="mcp-toc-label">On this page</div>
        <nav id="toc-nav"></nav>
    </aside>
</div>

<!-- Mobile FAB -->
<button class="mcp-fab" id="mcp-fab" aria-label="Menu">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12" />
        <line x1="3" y1="6" x2="21" y2="6" />
        <line x1="3" y1="18" x2="21" y2="18" />
    </svg>
</button>

<!-- ════════════════════  STYLES  ════════════════════ -->
<style>
    /* ── Tokens (inheriting from site's dark theme) ── */
    :root {
        --mcp-bg: #1a1a1a;
        --mcp-sidebar-bg: #151515;
        --mcp-surface: #222222;
        --mcp-surface-2: #2a2a2a;
        --mcp-border: #2d2d2d;
        --mcp-border-hi: #3a3a3a;
        --mcp-text: #c8c8d0;
        --mcp-heading: #eaeaef;
        --mcp-muted: #78788a;
        --mcp-primary: #6366f1;
        --mcp-primary-soft: rgba(99, 102, 241, .12);
        --mcp-cyan: #06b6d4;
        --mcp-green: #22c55e;
        --mcp-header-h: 56px;
        --mcp-sidebar-w: 240px;
        --mcp-toc-w: 200px;
        --mcp-font: 'Inter', -apple-system, 'Segoe UI', sans-serif;
        --mcp-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        --mcp-radius: 10px;
    }

    /* ── Layout ── */
    .mcp-wrap {
        display: grid;
        grid-template-columns: var(--mcp-sidebar-w) minmax(0, 1fr) var(--mcp-toc-w);
        max-width: 1380px;
        margin: 0 auto;
        min-height: calc(100vh - var(--mcp-header-h));
        font-family: var(--mcp-font);
    }

    /* ── LEFT SIDEBAR ── */
    .mcp-sidebar {
        position: sticky;
        top: var(--mcp-header-h);
        height: calc(100vh - var(--mcp-header-h));
        overflow-y: auto;
        background: var(--mcp-sidebar-bg);
        border-right: 1px solid var(--mcp-border);
        padding: 20px 0 60px;
    }

    .mcp-sidebar::-webkit-scrollbar {
        width: 0;
    }

    .mcp-nav-group {
        margin-bottom: 24px;
    }

    .mcp-nav-heading {
        padding: 0 18px;
        margin-bottom: 6px;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: .07em;
        text-transform: uppercase;
        color: var(--mcp-muted);
    }

    .mcp-nav-link {
        display: block;
        padding: 7px 18px 7px 20px;
        font-size: 13.5px;
        line-height: 1.4;
        color: var(--mcp-muted);
        text-decoration: none;
        border-left: 2px solid transparent;
        transition: color .15s, background .15s, border-color .15s;
    }

    .mcp-nav-link:hover {
        color: var(--mcp-text);
        background: rgba(255, 255, 255, .03);
    }

    .mcp-nav-link.active {
        color: #fff;
        background: var(--mcp-primary-soft);
        border-left-color: var(--mcp-primary);
    }

    /* ── MAIN CONTENT ── */
    .mcp-main {
        padding: 36px 48px 80px;
        max-width: 780px;
        color: var(--mcp-text);
        line-height: 1.7;
        font-size: 15px;
    }

    /* Hero */
    .mcp-hero {
        margin-bottom: 32px;
    }

    .mcp-hero-badge {
        display: inline-block;
        font-size: 11px;
        font-weight: 600;
        padding: 3px 10px;
        border-radius: 6px;
        margin-bottom: 14px;
        background: var(--mcp-primary-soft);
        color: var(--mcp-primary);
        letter-spacing: .04em;
        text-transform: uppercase;
    }

    .mcp-hero h1 {
        font-size: 28px;
        font-weight: 700;
        color: #fff;
        margin: 0 0 8px;
        line-height: 1.2;
    }

    .mcp-hero p {
        font-size: 16px;
        color: var(--mcp-muted);
        margin: 0;
    }

    /* Headings */
    .mcp-main h2 {
        font-size: 20px;
        font-weight: 600;
        color: var(--mcp-heading);
        margin: 48px 0 16px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--mcp-border);
        scroll-margin-top: calc(var(--mcp-header-h) + 20px);
    }

    .mcp-main h3 {
        font-size: 15px;
        font-weight: 600;
        color: var(--mcp-heading);
        margin: 28px 0 8px;
        scroll-margin-top: calc(var(--mcp-header-h) + 20px);
    }

    .mcp-main p {
        margin: 0 0 14px;
    }

    .mcp-main a {
        color: var(--mcp-primary);
        text-decoration: none;
    }

    .mcp-main a:hover {
        text-decoration: underline;
    }

    .mcp-main code {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: .87em;
        background: var(--mcp-primary-soft);
        color: #a5b4fc;
        font-family: var(--mcp-mono);
    }

    /* ── Cards ── */
    .mcp-grid-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .mcp-card {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 18px 20px;
        border-radius: var(--mcp-radius);
        background: var(--mcp-surface);
        border: 1px solid var(--mcp-border);
        color: var(--mcp-text);
        text-decoration: none;
        transition: border-color .2s, background .2s, transform .18s;
    }

    .mcp-card:hover {
        border-color: var(--mcp-primary);
        background: var(--mcp-surface-2);
        transform: translateY(-2px);
    }

    .mcp-card-top {
        display: flex;
        align-items: center;
    }

    .mcp-card-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: grid;
        place-items: center;
        background: var(--mcp-primary-soft);
        color: var(--mcp-primary);
    }

    .mcp-card strong {
        font-size: 14px;
        color: #fff;
    }

    .mcp-card p {
        margin: 0;
        font-size: 12.5px;
        color: var(--mcp-muted);
        line-height: 1.5;
    }

    /* ── Code Blocks ── */
    .mcp-code {
        border-radius: var(--mcp-radius);
        overflow: hidden;
        border: 1px solid var(--mcp-border);
        margin-bottom: 20px;
        background: #111111;
    }

    .mcp-code-bar {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 14px;
        background: rgba(0, 0, 0, .4);
        border-bottom: 1px solid var(--mcp-border);
        font-size: 12px;
        color: var(--mcp-muted);
    }

    .mcp-code-dots {
        display: flex;
        gap: 5px;
    }

    .mcp-code-dots i {
        display: block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }

    .mcp-code-dots i:nth-child(1) {
        background: #ff5f57;
    }

    .mcp-code-dots i:nth-child(2) {
        background: #febc2e;
    }

    .mcp-code-dots i:nth-child(3) {
        background: #28c840;
    }

    .mcp-code-bar span {
        flex: 1;
    }

    .mcp-copy {
        font-size: 11px;
        padding: 2px 10px;
        border-radius: 5px;
        background: rgba(255, 255, 255, .06);
        color: var(--mcp-muted);
        border: 1px solid var(--mcp-border);
        cursor: pointer;
        transition: background .15s, color .15s;
        font-family: var(--mcp-font);
    }

    .mcp-copy:hover {
        background: rgba(255, 255, 255, .1);
        color: #fff;
    }

    .mcp-code pre {
        margin: 0;
        padding: 16px 18px;
        overflow-x: auto;
        font-size: 13px;
        line-height: 1.6;
        color: #d4d4d8;
        font-family: var(--mcp-mono);
    }

    .mcp-code pre::-webkit-scrollbar {
        height: 4px;
    }

    .mcp-code pre::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, .08);
        border-radius: 4px;
    }

    /* ── Features ── */
    .mcp-feature-list {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .mcp-feat {
        display: flex;
        align-items: flex-start;
        gap: 14px;
        padding: 14px 16px;
        border-radius: 8px;
        transition: background .15s;
    }

    .mcp-feat:hover {
        background: rgba(255, 255, 255, .02);
    }

    .mcp-feat-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
        margin-top: 6px;
        background: var(--c);
    }

    .mcp-feat strong {
        color: var(--mcp-heading);
        font-size: 14px;
        display: block;
        margin-bottom: 2px;
    }

    .mcp-feat p {
        margin: 0;
        font-size: 13px;
        color: var(--mcp-muted);
    }

    /* ── Tables ── */
    .mcp-tbl-wrap {
        overflow-x: auto;
        border-radius: var(--mcp-radius);
        border: 1px solid var(--mcp-border);
        margin-bottom: 20px;
    }

    .mcp-tbl {
        width: 100%;
        border-collapse: collapse;
        font-size: 13.5px;
    }

    .mcp-tbl thead {
        background: var(--mcp-surface);
    }

    .mcp-tbl th {
        padding: 10px 16px;
        text-align: left;
        font-weight: 600;
        color: var(--mcp-muted);
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: .05em;
        border-bottom: 1px solid var(--mcp-border);
    }

    .mcp-tbl td {
        padding: 10px 16px;
        border-top: 1px solid var(--mcp-border);
        color: var(--mcp-text);
    }

    .mcp-tbl td code {
        background: var(--mcp-primary-soft);
        color: #a5b4fc;
    }

    .mcp-tbl tbody tr {
        transition: background .12s;
    }

    .mcp-tbl tbody tr:hover {
        background: rgba(255, 255, 255, .02);
    }

    /* ── RIGHT TOC ── */
    .mcp-toc {
        position: sticky;
        top: var(--mcp-header-h);
        height: calc(100vh - var(--mcp-header-h));
        overflow-y: auto;
        padding: 24px 14px 40px;
        border-left: 1px solid var(--mcp-border);
    }

    .mcp-toc::-webkit-scrollbar {
        width: 0;
    }

    .mcp-toc-label {
        font-size: 11px;
        font-weight: 600;
        letter-spacing: .07em;
        text-transform: uppercase;
        color: var(--mcp-muted);
        margin-bottom: 12px;
        padding-left: 10px;
    }

    .mcp-toc a {
        display: block;
        padding: 3px 0 3px 10px;
        font-size: 12.5px;
        color: var(--mcp-muted);
        text-decoration: none;
        border-left: 2px solid transparent;
        transition: color .12s, border-color .12s;
    }

    .mcp-toc a:hover {
        color: var(--mcp-text);
    }

    .mcp-toc a.active {
        color: #fff;
        border-left-color: var(--mcp-primary);
    }

    .mcp-toc a.toc-h3 {
        padding-left: 22px;
        font-size: 12px;
    }

    /* ── Mobile Overlay ── */
    .mcp-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, .55);
        z-index: 90;
    }

    .mcp-fab {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 80;
        width: 48px;
        height: 48px;
        border-radius: 14px;
        background: var(--mcp-primary);
        color: #fff;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(99, 102, 241, .35);
        place-items: center;
        transition: transform .15s;
    }

    .mcp-fab:hover {
        transform: scale(1.05);
    }

    /* ════ Responsive ════ */
    @media (max-width: 1100px) {
        .mcp-toc {
            display: none;
        }

        .mcp-wrap {
            grid-template-columns: var(--mcp-sidebar-w) 1fr;
        }
    }

    @media (max-width: 768px) {
        .mcp-fab {
            display: grid;
        }

        .mcp-wrap {
            grid-template-columns: 1fr;
        }

        .mcp-sidebar {
            position: fixed;
            top: var(--mcp-header-h);
            left: 0;
            bottom: 0;
            width: 260px;
            z-index: 95;
            transform: translateX(-100%);
            transition: transform .25s cubic-bezier(.4, 0, .2, 1);
            box-shadow: 4px 0 24px rgba(0, 0, 0, .4);
        }

        .mcp-sidebar.open {
            transform: translateX(0);
        }

        .mcp-overlay.open {
            display: block;
        }

        .mcp-main {
            padding: 24px 18px 60px;
        }

        .mcp-grid-cards {
            grid-template-columns: 1fr;
        }

        .mcp-hero h1 {
            font-size: 22px;
        }
    }
</style>

<!-- ════════════════════  SCRIPTS  ════════════════════ -->
<script>
    document.addEventListener('DOMContentLoaded', () => {

        /* ── Nav Data ── */
        const NAV = [
            {
                title: 'Getting Started', items: [
                    { label: 'Overview', href: '#section-overview' },
                    { label: 'Install', href: '#section-install' },
                    { label: 'Quick Start', href: '#section-quick-start' },
                    { label: 'Features', href: '#section-features' },
                ]
            },
            {
                title: 'Configuration', items: [
                    { label: 'Manhattan Remote (SSE)', href: '#section-config' },
                ]
            },
            {
                title: 'Tools Reference', items: [
                    { label: 'Memory Operations', href: '#section-memory-ops' },
                    { label: 'Agent Management', href: '#section-agent-mgmt' },
                    { label: 'Session Management', href: '#section-session-mgmt' },
                    { label: 'AI Helpers', href: '#section-ai-helpers' },
                ]
            },
        ];

        /* Render Sidebar */
        const sidebarNav = document.getElementById('sidebar-nav');
        NAV.forEach(g => {
            const div = document.createElement('div');
            div.className = 'mcp-nav-group';
            div.innerHTML = `<div class="mcp-nav-heading">${g.title}</div>`;
            g.items.forEach(item => {
                const a = document.createElement('a');
                a.className = 'mcp-nav-link';
                a.href = item.href;
                a.textContent = item.label;
                div.appendChild(a);
            });
            sidebarNav.appendChild(div);
        });

        /* Render TOC */
        const tocNav = document.getElementById('toc-nav');
        document.querySelectorAll('.mcp-main h2, .mcp-main h3').forEach(h => {
            const id = h.id || h.closest('.mcp-section')?.id;
            if (!id) return;
            const a = document.createElement('a');
            a.href = `#${id}`;
            a.textContent = h.textContent.trim();
            if (h.tagName === 'H3') a.classList.add('toc-h3');
            tocNav.appendChild(a);
        });

        /* Scroll Spy */
        const sections = document.querySelectorAll('.mcp-section');
        const navLinks = document.querySelectorAll('.mcp-nav-link');
        const tocLinks = document.querySelectorAll('#toc-nav a');
        const headings = document.querySelectorAll('.mcp-main h2[id], .mcp-main h3[id]');

        function spy() {
            let cur = '';
            sections.forEach(s => { if (s.getBoundingClientRect().top < 100) cur = s.id; });
            navLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href') === `#${cur}`));

            let curH = '';
            headings.forEach(h => { if (h.getBoundingClientRect().top < 100) curH = h.id; });
            if (!curH) sections.forEach(s => { if (s.getBoundingClientRect().top < 100) curH = s.id; });
            tocLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href') === `#${curH}`));
        }
        window.addEventListener('scroll', spy, { passive: true });
        spy();

        /* Copy */
        document.querySelectorAll('.mcp-copy').forEach(btn => {
            btn.addEventListener('click', () => {
                const code = btn.closest('.mcp-code').querySelector('code').textContent;
                navigator.clipboard.writeText(code);
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 1800);
            });
        });

        /* Mobile */
        const fab = document.getElementById('mcp-fab');
        const sidebar = document.getElementById('mcp-sidebar');
        const overlay = document.getElementById('mcp-overlay');
        function toggle(open) { sidebar.classList.toggle('open', open); overlay.classList.toggle('open', open); }
        fab.addEventListener('click', () => toggle(!sidebar.classList.contains('open')));
        overlay.addEventListener('click', () => toggle(false));
        sidebarNav.addEventListener('click', e => { if (e.target.classList.contains('mcp-nav-link')) toggle(false); });

        /* Smooth Scroll */
        document.querySelectorAll('a[href^="#"]').forEach(a => {
            a.addEventListener('click', e => {
                const t = document.querySelector(a.getAttribute('href'));
                if (t) { e.preventDefault(); t.scrollIntoView({ behavior: 'smooth', block: 'start' }); history.replaceState(null, '', a.getAttribute('href')); }
            });
        });
    });
</script>
{% endblock %}